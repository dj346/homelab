
alloy:
  clustering:
    enabled: false
    name: ""
    portName: http

  configMap:
    create: true
    content: |-
      prometheus.remote_write "mimir" {
        endpoint {
          url     = "http://mimir-distributor.mimir.svc.cluster.local:8080/api/v1/push"
          
          headers = {
            "X-Scope-OrgID" = "anonymous",
          }
        }
      }

      prometheus.exporter.self "self_metrics" {}

      prometheus.scrape "self_scrape" {
        targets    = prometheus.exporter.self.self_metrics.targets
        forward_to = [prometheus.remote_write.mimir.receiver]
      }

      prometheus.scrape "mimir_all_components" {
        targets = [
          { "__address__" = "mimir-alertmanager.mimir.svc.cluster.local:8080" },
          { "__address__" = "mimir-alertmanager-headless.mimir.svc.cluster.local:8080" },

          { "__address__" = "mimir-compactor.mimir.svc.cluster.local:8080" },

          { "__address__" = "mimir-distributor.mimir.svc.cluster.local:8080" },
          { "__address__" = "mimir-distributor-headless.mimir.svc.cluster.local:8080" },

          { "__address__" = "mimir-overrides-exporter.mimir.svc.cluster.local:8080" },

          { "__address__" = "mimir-querier.mimir.svc.cluster.local:8080" },
          { "__address__" = "mimir-query-frontend.mimir.svc.cluster.local:8080" },

          { "__address__" = "mimir-query-scheduler.mimir.svc.cluster.local:8080" },
          { "__address__" = "mimir-query-scheduler-headless.mimir.svc.cluster.local:8080" },

          { "__address__" = "mimir-ruler.mimir.svc.cluster.local:8080" },

          { "__address__" = "mimir-store-gateway-zone-a.mimir.svc.cluster.local:8080" },
          { "__address__" = "mimir-store-gateway-zone-b.mimir.svc.cluster.local:8080" },
          { "__address__" = "mimir-store-gateway-zone-c.mimir.svc.cluster.local:8080" },
          { "__address__" = "mimir-store-gateway-headless.mimir.svc.cluster.local:8080" },
        ]
        forward_to = [prometheus.remote_write.mimir.receiver]
      }


  storagePath: /tmp/alloy

  listenAddr: 0.0.0.0
  listenPort: 12345
  listenScheme: HTTP

  # Telemetry configuration
  enableReporting: true

  mounts:
    varlog: false
    dockercontainers: false
    extra: []

  resources: {}

configReloader:
  enabled: true

  resources:
    requests:
      cpu: "10m"
      memory: "50Mi"

controller:
  replicas: 1

  extraAnnotations: {}
  podAnnotations: {}
  podLabels: {}

  # -- PodDisruptionBudget configuration.
  podDisruptionBudget:
    # -- Whether to create a PodDisruptionBudget for the controller.
    enabled: false
    # -- Minimum number of pods that must be available during a disruption.
    # Note: Only one of minAvailable or maxUnavailable should be set.
    minAvailable: null
    # -- Maximum number of pods that can be unavailable during a disruption.
    # Note: Only one of minAvailable or maxUnavailable should be set.
    maxUnavailable: null

  # -- Whether to enable automatic deletion of stale PVCs due to a scale down operation, when controller.type is 'statefulset'.
  enableStatefulSetAutoDeletePVC: false

  autoscaling:
    horizontal:
      enabled: false
      minReplicas: 1
      maxReplicas: 5
      targetCPUUtilizationPercentage: 0
      targetMemoryUtilizationPercentage: 80

      scaleDown:
        policies: []
        selectPolicy: Max
        stabilizationWindowSeconds: 300

      scaleUp:
        policies: []
        selectPolicy: Max
        stabilizationWindowSeconds: 0
    vertical:
      enabled: false
      recommenders: []
      resourcePolicy:
        containerPolicies:
        - containerName: alloy
          controlledResources:
          - cpu
          - memory
          controlledValues: "RequestsAndLimits"
          maxAllowed: {}
          minAllowed: {}

service:
  enabled: true
  type: ClusterIP
  nodePort: 31128
  clusterIP: ''
  internalTrafficPolicy: Cluster
  annotations: {}

serviceMonitor:
  enabled: false
  additionalLabels: {}
  interval: ""
  metricRelabelings: []
  tlsConfig: {}
  relabelings: []

ingress:
  enabled: false
  annotations: {}
  labels: {}
  path: /
  faroPort: 12347
  pathType: Prefix
  hosts:
    - chart-example.local
  extraPaths: []

  tls: []