apiVersion: minio.min.io/v2
kind: Tenant
metadata:
  name: mimir-bucket
  namespace: mimir
  labels:
    app.kubernetes.io/name: mimir
    app.kubernetes.io/component: tsdb
  annotations: {}
spec:    
  requestAutoCert: true
  externalCertSecret:
    - name: mimir-bucket-tls
      type: cert-manager.io/v1

  exposeServices: 
    minio: false
    console: false

  features:
    domains: 
      minio:
        - mimir-minio.kube-prod-d1.mclacken.net
      console: mimir-minio-console.kube-prod-d1.mclacken.net
  
  configuration:
    name: minio-secret

  # env:
  #   - name: MINIO_ROOT_USER
  #     value: root-user
  #     # valueFrom:
  #     #   secretKeyRef:
  #     #     name: minio-creds
  #     #     key: root-user
  #     #     optional: false
  #   - name: MINIO_ROOT_PASSWORD
  #     value: root-password
  #     # valueFrom:
  #     #   secretKeyRef:
  #     #     name: minio-creds
  #     #     key: root-password
  #     #     optional: false

  buckets: 
    - name: somebucket1
      region: us-west-1
      objectLock: false

  serviceMetadata: 
    minioServiceLabels:
      app.kubernetes.io/name: mimir
      app.kubernetes.io/component: tsdb
    minioServiceAnnotations: {}
    consoleServiceLabels:
      app.kubernetes.io/name: mimir
      app.kubernetes.io/component: tsdb
    consoleServiceAnnotations: {}
    kesServiceLabels:
      app.kubernetes.io/name: mimir
      app.kubernetes.io/component: tsdb
    kesServiceAnnotations: {}

  poolsMetadata:
    annotations: {}
    labels:
      app.kubernetes.io/name: mimir
      app.kubernetes.io/component: tsdb

  pools:
    - servers: 4
      name: pool-0
      volumesPerServer: 1
      
      labels: 
        app.kubernetes.io/name: mimir
        app.kubernetes.io/component: tsdb
      annotations: { }

      volumeClaimTemplate:
        apiVersion: v1
        kind: PersistentVolumeClaim
        metadata: 
          name: pool-0
          namespace: mimir
          labels:
            app.kubernetes.io/name: mimir
            app.kubernetes.io/component: tsdb
        spec:
          accessModes:
            - ReadWriteOnce
          resources:
            requests:
              storage: 5Gi
          storageClassName: longhorn-strict-local
        status: { }
      
      resources: { }

      securityContext:
        runAsUser: 1000
        runAsGroup: 1000
        fsGroup: 1000
        fsGroupChangePolicy: "OnRootMismatch"
        runAsNonRoot: true

      containerSecurityContext:
        runAsUser: 1000
        runAsGroup: 1000
        runAsNonRoot: true
        allowPrivilegeEscalation: false
        capabilities:
          drop:
            - ALL
        seccompProfile:
          type: RuntimeDefault
  
  # metrics:
  #   enabled: false
  #   port: 9000
  #   protocol: http

  # Directs the Operator to add the Tenant's metric scrape configuration to an existing Kubernetes Prometheus deployment managed by the Prometheus Operator.
  prometheusOperator: false

  logging: { }
