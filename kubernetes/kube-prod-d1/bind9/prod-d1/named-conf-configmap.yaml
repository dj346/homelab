apiVersion: v1
kind: ConfigMap
metadata:
  name: bind-config
data:
  named.conf.local: |
    //
    // Do any local configuration here
    //

    // Consider adding the 1918 zones here, if they are not used in your
    // organization
    //include "/etc/bind/zones.rfc1918";

    include "/etc/bind/dhcp1-ns1.key";

    zone "mclacken.net" {
      type master;
      file "/var/lib/bind/mclacken-net.zone"; # zone file path
      update-policy {
        grant dhcp1-ns1 wildcard *.mclacken.net A DHCID;
      };
    };

    zone "networking.mclacken.net" {
            type master;
            file "/var/lib/bind/networking-mclacken-net.zone"; # zone file path
    };

    zone "apps.mclacken.net" {
            type master;
            file "/var/lib/bind/apps-mclacken-net.zone"; # zone file path
    };

    zone "lightapps.mclacken.net" {
            type master;
            file "/var/lib/bind/lightapps-mclacken-net.zone"; # zone file path
    };

    zone "kube-prod-d1.mclacken.net" {
      type master;
      file "/var/lib/bind/kube-prod-d1-mclacken-net.zone";
    };

    zone "pwings-prod-d1.mclacken.net" {
      type master;
      file "/var/lib/bind/pwings-prod-d1-mclacken-net.zone";
    };

    zone "ratgang.lgbt" {
            type master;
            file "/var/lib/bind/ratgang-lgbt.zone"; # zone file path
    };

    zone "local.mclacken.net" {
      type master;
      file "/var/lib/bind/local-mclacken-net.zone"; #zone file path
    };

    zone "21.15.10.in-addr.arpa" {
      type master;
      file "/var/lib/bind/21.15.10.zone";
      update-policy {
        grant dhcp1-ns1 wildcard *.21.15.10.in-addr.arpa PTR DHCID;
      };
    };

  named.conf.options: |
    acl "trusted" {
        10.15.21.0/24; // Management subnet (168.192.in-addr.arpa)
        10.15.22.0/24; // Main subnet  (1.168.192.in-addr.arpa)
      172.21.0.0/16; // Docker subnet
      10.11.12.0/24; // Moms subnet
    };

    options {
            directory "/var/cache/bind";
            version none;
            recursion yes;
            allow-query { trusted; };
            dnssec-validation auto;
            allow-transfer { none; };
            auth-nxdomain no;
            listen-on-v6 { any; };
            allow-recursion { trusted; };  # allows recursive queries from "trusted" clients
            forwarders {
                    1.1.1.1;
                    1.0.0.1;
            };
    };
