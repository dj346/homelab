global:
  # -- Default domain used by all netponents
  ## Used for ingresses, certificates, SSO, notifications, etc.
  domain: argocd.kube-prod-d1.mclacken.net

server:
  extraArgs:
    - --insecure

configs:
  cm:
    dex.config: |
      connectors:
      - type: ldap
        name: LLDAP
        id: ldap
        config:
          host: "lldap.kube-prod-d1.mclacken.net:636"
          insecureNoSSL: true
          insecureSkipVerify: true
          bindDN: "cn=argocd_service,dc=mclacken,dc=net"
          bindPW: "$LDAP_BIND_PW"
          usernamePrompt: Username
          userSearch:
            baseDN: "ou=users,dc=mclacken,dc=net"
            filter: "(|(memberOf=cn=argocd_admins,ou=groups,dc=mclacken,dc=net)(memberOf=cn=argocd_users,ou=groups,dc=mclacken,dc=net))"
            username: uid
            idAttr: uid
            emailAttr: mail
            nameAttr: displayName
          groupSearch:
            baseDN: "ou=groups,dc=mclacken,dc=net"
            filter: "(objectClass=groupOfNames)"
            nameAttr: cn
            userMatchers:
              - userAttr: DN  # ✅ Equivalent to the old `userAttr`
                groupAttr: member  # ✅ Equivalent to the old `groupAttr`
  
  secret:
    extra:
      # LDAP_BIND_DN:
      #   name: ldap-bind-user-secret
      #   key: ldap.bindDN
      LDAP_BIND_PW:
        name: ldap-bind-user-secret
        key: bindPW

  rbac:
    policy.csv: |
      g, argocd_admins, role:admin
      g, argocd_users, role:readonly
    policy.default: role:readonly
