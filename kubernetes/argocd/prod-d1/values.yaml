global:
  domain: argocd.kube-prod-d1.mclacken.net

server:
  extraArgs:
    - --insecure

configs:
  cm:
    dex.config: |
      connectors:
      - type: ldap
        name: LLDAP
        id: ldap
        config:
          host: "lldap-service.lldap.svc.cluster.local:3890"
          insecureNoSSL: true
          insecureSkipVerify: true
          bindDN: "$argocd-ldap-bind-user-secret:lldap.bindDN"
          bindPW: "$argocd-ldap-bind-user-secret:lldap.bindPW"
          usernamePrompt: Username
          userSearch:
            baseDN: "dc=mclacken,dc=net"
            filter: "(&(objectClass=person)(|(memberof=cn=argocd-users,ou=groups,dc=mclacken,dc=net)(memberof=cn=argocd-admins,ou=groups,dc=mclacken,dc=net)))"
            username: uid
            idAttr: uid
            emailAttr: mail
            nameAttr: displayName
            preferredUsernameAttr: uid
          groupSearch:
            baseDN: "dc=mclacken,dc=net"
            filter: "(&(objectClass=groupofuniquenames)(|(cn=argocd-users)(cn=argocd-admins)))"
            nameAttr: cn
            userMatchers:
              - userAttr: DN
                groupAttr: member

  rbac:
    policy.csv: |
      g, argocd-admins, role:admin
      g, argocd-users, role:readonly
    policy.default: role:readonly
