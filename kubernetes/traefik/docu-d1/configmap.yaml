apiVersion: v1
kind: ConfigMap
metadata:
  name: traefik-configmap
  namespace: traefik
data:
  config.yaml: |
    http:
      routers:
        nut:
          entryPoints:
              - "https"
          rule: "Host(`nut.local.mclacken.net`)"
          middlewares:
              - addprefix-nut
              - default-headers
          tls: {}
          service: nut
        proxmox:
          entryPoints:
              - "https"
          rule: "Host(`proxmox.local.mclacken.net`)"
          middlewares:
              - default-headers
          tls: {}
          service: proxmox
        pixmox:
          entryPoints:
              - "https"
          rule: "Host(`pimox.local.mclacken.net`)"
          middlewares:
              - default-headers
          tls: {}
          service: pixmox
        unraid:
          entryPoints:
              - "https"
          rule: "Host(`unraid.local.mclacken.net`)"
          middlewares:
              - default-headers
          tls: {}
          service: unraid
        router:
          entryPoints:
              - "https"
          rule: "Host(`router.local.mclacken.net`)"
          tls: {}
          service: router

      middlewares:
        vaultwarden-stripPrefix:
          stripPrefix:
              prefixes:
                - "/notifications/hub"
              forceSlash: false
        addprefix-pihole:
          addPrefix:
              prefix: "/admin"
        addprefix-nut:
          addPrefix:
              prefix: "/cgi-bin/nut/upsstats.cgi"
        default-headers:
          headers:
              frameDeny: true
              browserXssFilter: true
              contentTypeNosniff: true
              forceSTSHeader: true
              stsIncludeSubdomains: true
              stsPreload: true
              stsSeconds: 15552000
              customFrameOptionsValue: SAMEORIGIN
              customRequestHeaders:
                X-Forwarded-Proto: https

      services:
        nut:
          loadBalancer:
              servers:
                - url: "http://192.168.1.6:80"
              passHostHeader: true
        proxmox:
          loadBalancer:
              servers:
                - url: "https://192.168.1.2:8006"
              passHostHeader: true
        pixmox:
          loadBalancer:
              servers:
                - url: "https://192.168.1.5:8006"
              passHostHeader: true
        unraid:
          loadBalancer:
              servers:
                - url: "https://192.168.1.3:443"
              passHostHeader: true
        router:
          loadBalancer:
              servers:
                - url: "http://192.168.1.1:80"
              passHostHeader: true
